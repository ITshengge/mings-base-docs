# 国际化

mings-base-frame 使用 vue-i18n 来实现国际化方案。用于应对可能存在的国际项目的需求。

## 语言包

前端基础框架的语言包包括：中文，英文两种，都是一些常用的语句，存放地址在：/src/locales 目录下，包括：

- 整体应用相关的

- 侧边栏相关的

- 用户操作相关的

- 数据请求相关的

- 空数据相关的

## 中文语言包

```js
export default {
  /**
   * 整体应用相关
   */
  app: {
    title: "普睿后台管理系统",
    login: "登录",
    logout: "退出登录",
    changePassword: "修改密码",
    username: "用户名",
    password: "密码",
    theme: {
      dark: "深色",
      light: "浅色",
    },
  },
  /**
   * 侧边栏相关
   */
  sidebar: {},
  /**
   * 操作提示消息相关
   * @description : 当我们执行某个操作时，会请求后端接口，会存在请求前的提示（比如：提示是否需要删除该数据等）和请求中的提示（比如：正在加载，请稍等）以及请求后的提示（比如：操作成功，操作失败等）
   */
  operation: {
    /**
     * 删除操作相关提示，其中包括删除提示标题，删除提示内容，删除提示描述
     * @description : 当我们执行删除操作时，会有相关的提示信息
     */
    delete: {
      title: "删除提示",
      content: "您确定要删除该数据吗？",
      description: "删除该数据后将无法恢复，请谨慎操作。",
    },
    /**
     * 提交操作相关提示，其中包括提交中的提示，提交成功的提示，提交失败的提示
     * @description : 当我们执行提交操作时，会有相关的提示信息
     */
    submit: {
      loading: "操作中...",
      success: "操作成功",
      error: "操作异常，请稍后再试",
    },
    /**
     * 请求数据操作相关提示，其中包括请求中的提示
     * @description : 当我们执行请求操作时，会有相关的提示信息
     */
    fetch: {
      loading: "加载中...",
    },
  },
  /**
   * 空数据相关提示
   */
  empty: {
    title: "暂无数据",
    description: "当前页面没有任何数据，请检查网络连接或稍后再试。",
  },
};
```

## 英文语言包

```js
export default {
  /**
   * 整体应用相关
   */
  app: {
    title: "Purui Admin System",
    login: "Login",
    logout: "Logout",
    changePassword: "Change Password",
    username: "Username",
    password: "Password",
    theme: {
      dark: "Dark",
      light: "Light",
    },
  },
  /**
   * 侧边栏相关
   */
  sidebar: {},
  /**
   * 操作提示消息相关
   * @description : 当我们执行某个操作时，会请求后端接口，会存在请求前的提示（比如：提示是否需要删除该数据等）和请求中的提示（比如：正在加载，请稍等）以及请求后的提示（比如：操作成功，操作失败等）
   */
  operation: {
    /**
     * 删除操作相关提示，其中包括删除提示标题，删除提示内容，删除提示描述
     * @description : 当我们执行删除操作时，会有相关的提示信息
     */
    delete: {
      title: "Delete Confirmation",
      content: "Are you sure you want to delete this data?",
      description:
        "Deleting this data cannot be undone, please proceed with caution.",
    },
    /**
     * 提交操作相关提示，其中包括提交中的提示，提交成功的提示，提交失败的提示
     * @description : 当我们执行提交操作时，会有相关的提示信息
     */
    submit: {
      loading: "Processing...",
      success: "Operation successful",
      error: "An error occurred, please try again later",
    },
    /**
     * 请求数据操作相关提示，其中包括请求中的提示
     * @description : 当我们执行请求操作时，会有相关的提示信息
     */
    fetch: {
      loading: "Loading...",
    },
  },
  /**
   * 空数据相关提示
   */
  empty: {
    title: "No Data Available",
    description:
      "There is currently no data on this page. Please check your network connection or try again later.",
  },
};
```

## 如何使用

- 1、在/src/locales/index.ts 文件中，先创建 i18n。

```ts
import zh from "./zh";
import en from "./en";
import { createI18n } from "vue-i18n";
const messages = {
  zh: zh,
  en: en,
};
const i18n = createI18n({
  locale: "zh",
  fallbackLocale: "zh",
  legacy: false,
  globalInjection: true,
  messages,
});
export default i18n;
```

- 2、然后在/src/main.ts 文件中引入这个文件，并使用 app.use()注入进来。

```ts
import i18n from "@/locales";
import { createApp } from "vue";
import App from "./App.vue";
const app = createApp(App);
app.use(i18n);
```

- 3、调用 configStore.updateLocale 方法切换语言。

```ts
/**
 * 切换语言
 * @param lang 语言
 * @param refresh 是否需要刷新页面
 */
updateLocale (lang: LangType , refresh?: boolean) {
  this.config = merge({} , this.config , {app : {lang}});
  i18n.global.locale.value = lang;
  if (refresh) {
    setTimeout(() => {
      window.location.reload();
    })
  }
}
```

## 内容替换

针对需要切换语言的地方，我们都需要使用 vue-i18n 提供的方法去替换文本。具体可以参考[官方文档](https://vue-i18n.intlify.dev/)。我这里就举例说明一些常用的场景。

- 1、在 template 模板中使用。

```vue
<template>
  <div>{{ $t("app.title") }}</div>
</template>
```

- 2、在 ts 中使用，最好使用 computed 去定义数据，如果使用 ref 不会导致切换语言时，数据发生变化。

```vue
<template>
  <div>{{ name }}</div>
  <div>{{ data.address }}</div>
  <button @click="onClick"></button>
</template>
<script lang="ts" setup>
import { useI18n } from "vue-i18n";
import { computed } from "vue";
import { useConfigStore } from "@/stores/configs/config";
const configStore = useConfigStore();
const { t } = useI18n();
const name = computed(() => t("app.title"));
const data = computed(() => ({
  address: t("app.title"),
}));
const onClick = () => {
  const lang = configStore.getLocale();
  configStore.updateLocale(lang === "en" ? "zh" : "en");
};
</script>
```

::: warning
这里需要注意的是，如果点击之后，语言没有切换，首先需要排查的就是数据是否已经是随着语言切换的变化而变化了。如果 name 我们使用 ref 去定义，那么切换语言的时候就不会生效。

如果都不能解决问题，那么我们调用 configStore.updateLocale 方法时，传入第二个参数，表示是否刷新页面，我们重新刷新一下页面即可。
:::

- 3、如果你就是要用 ref 去定义数据并渲染数据，并且你也不想刷新页面，那么可以在切换语言后，重新赋值，或者使用 watch 监听。

```vue
<template>
  <div>{{ data.address }}</div>
  <button @click="onClick"></button>
</template>
<script lang="ts" setup>
import { useI18n } from "vue-i18n";
import { ref, watch } from "vue";
import { useConfigStore } from "@/stores/configs/config";
const configStore = useConfigStore();
const { t, locale } = useI18n();
const data = ref({
  address: t("app.title"),
});
// 或者使用watch，监听locale变化
watch(locale, () => {
  data.value.address = t("app.title");
});
const onClick = () => {
  const lang = configStore.getLocale();
  configStore.updateLocale(lang === "en" ? "zh" : "en");
  // 切换语言后，重新再赋值一次
  data.value.address = t("app.title");
};
</script>
```

## 注意点

::: danger
vue-i18n 还有很多其他的 api，用法也很灵活，具体还是要去参考[官方文档](https://vue-i18n.intlify.dev/)，我这里也只是简单的说明了一些常用的使用场景，后续在实际开发项目中，遇到问题，还是要自己去查看官方文档。
:::
